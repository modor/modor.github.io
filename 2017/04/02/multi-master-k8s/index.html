<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.png"><link rel="stylesheet" href="/styles.css"><title>多主k8s集群部署 | </title></head><body><div class="container"><div class="columns"><div class="navigation"><nav class="menus-main"><a href="/" class="favicon"><img src="/logo.png"></a><a href="/">首页</a><a href="/">技术文章</a><a href="/">我的翻译</a><a href="/">日常随笔</a><a href="/">关于作者</a></nav><nav class="right menus-right"><a href="/">RSS</a><a target="_blank" href="https://github.com/modor">Github</a></nav></div></div><div class="columns"><div class="block-body column three-fourths"><article><header><small class="right"><a target="_blank" href="null_posts%2Fmulti-master-k8s.md">查看源代码</a></small><h1>多主k8s集群部署</h1></header><div class="article-meta clearfix"><time class="left">2017-04-02</time><ul class="tags left"></ul><ul class="tags right"></ul></div><div class="markdown-body"><p><strong>说明</strong>：为集群分配了三台master，三台node，三台master使用keepalived做master高可用；同时，三台master也作为etcd集群的节点。</p>
<p><strong>集群IP分配:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">IP                       node                   components</div><div class="line">192.168.48.201           master                 apiserver，controller-manager，scheduler，etcd，keepalived</div><div class="line">192.168.48.202           master                 apiserver，controller-manager，scheduler，etcd，keepalived</div><div class="line">192.168.48.203           master                 apiserver，controller-manager，scheduler，etcd，keepalived</div><div class="line">192.168.48.204           node                   kubelet，proxy，docker</div><div class="line">192.168.48.205           node                   kubelet，proxy，docker</div><div class="line">192.168.48.206           node                   kubelet，proxy，docker</div><div class="line">192.168.48.234           虚拟ip</div></pre></td></tr></table></figure></p>
<h3 id="1-首先，部署etcd集群"><a href="#1-首先，部署etcd集群" class="headerlink" title="1.首先，部署etcd集群"></a>1.首先，部署etcd集群</h3><p>在192.168.48.201、192.168.48.203、192.168.48.203上执行如下操作：</p>
<p>1)在三台master上分别安装etcd：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y etcd</div></pre></td></tr></table></figure>
<p>2)修改配置文件（/etc/etcd/etcd.conf）</p>
<p>etcd1（192.168.48.201）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ETCD_NAME=etcd1</div><div class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/etcd1&quot;</div><div class="line">ETCD_LISTEN_PEER_URLS=&quot;http://192.168.48.201:2380&quot;</div><div class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:2379&quot;</div><div class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://192.168.48.201:2380&quot;</div><div class="line">ETCD_INITIAL_CLUSTER=&quot;etcd1=http://192.168.48.201:2380,etcd2=http://192.168.48.202:2380,etcd3=http://192.168.48.203:2380&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;k8s-etcd&quot;</div><div class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://192.168.48.201:2379&quot;</div></pre></td></tr></table></figure>
<p>etcd2(192.168.48.202):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ETCD_NAME=etcd2</div><div class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/etcd2&quot;</div><div class="line">ETCD_LISTEN_PEER_URLS=&quot;http://192.168.48.202:2380&quot;</div><div class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:2379&quot;</div><div class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://192.168.48.202:2380&quot;</div><div class="line">ETCD_INITIAL_CLUSTER=&quot;etcd1=http://192.168.48.201:2380,etcd2=http://192.168.48.202:2380,etcd3=http://192.168.48.203:2380&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;k8s-etcd&quot;</div><div class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://192.168.48.202:2379&quot;</div></pre></td></tr></table></figure>
<p>etcd3(192.168.48.203):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ETCD_NAME=etcd3</div><div class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/etcd3&quot;</div><div class="line">ETCD_LISTEN_PEER_URLS=&quot;http://192.168.48.203:2380&quot;</div><div class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://0.0.0.0:2379&quot;</div><div class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://192.168.48.203:2380&quot;</div><div class="line">ETCD_INITIAL_CLUSTER=&quot;etcd1=http://192.168.48.201:2380,etcd2=http://192.168.48.202:2380,etcd3=http://192.168.48.203:2380&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</div><div class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;k8s-etcd&quot;</div><div class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://192.168.48.203:2379&quot;</div></pre></td></tr></table></figure>
<p>3)启动所有节点上的etcd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl stop etcd</div></pre></td></tr></table></figure>
<h3 id="2-第二，部署Kubernetes-Master组件"><a href="#2-第二，部署Kubernetes-Master组件" class="headerlink" title="2.第二，部署Kubernetes Master组件"></a>2.第二，部署Kubernetes Master组件</h3><p>在192.168.48.201、192.168.48.203、192.168.48.203上执行如下操作：</p>
<p>1）安装所需组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install kubernetes kubernetes-client</div></pre></td></tr></table></figure>
<p>2）修改apiserver配置文件（/etc/kubernetes/apiserver）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">KUBE_API_ADDRESS=&quot;--insecure-bind-address=0.0.0.0&quot;</div><div class="line">KUBE_ETCD_SERVERS=&quot;--etcd-servers=http://192.168.48.201:2379,http://192.168.48.202:2379,http://192.168.48.203&quot;</div><div class="line">KUBE_SERVICE_ADDRESSES=&quot;--service-cluster-ip-range=10.254.0.0/16&quot;</div><div class="line">KUBE_ADMISSION_CONTROL=&quot;--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota&quot;</div><div class="line">KUBE_API_ARGS=&quot;--secure-port=0&quot;</div></pre></td></tr></table></figure>
<p>3）kube-controller-manager和kube-scheduler的配置文件不用修改。</p>
<p>4）启动kube-apiserver、kube-controller-manager、kube-scheduler：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">for SERVICES in kube-apiserver kube-controller-manager kube-scheduler; do</div><div class="line">	systemctl start $SERVICES</div><div class="line">	systemctl enable $SERVICES</div><div class="line">done</div></pre></td></tr></table></figure>
<h3 id="3-第三，部署Kubernetes-Node组件"><a href="#3-第三，部署Kubernetes-Node组件" class="headerlink" title="3.第三，部署Kubernetes Node组件"></a>3.第三，部署Kubernetes Node组件</h3><p>在192.168.48.204、192.168.48.205、192.168.48.206上执行如下操作：<br>1）安装所需组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install flannel docker kubernetes</div></pre></td></tr></table></figure>
</div></article></div><div class="block-sidebar column one-fourth"><div class="widget text-content"><h2 id="-u-u-"><u>分类目录</u></h2>
<ul>
<li>Kubernetes    </li>
<li>Java</li>
<li>网络</li>
</ul>
</div><div class="widget archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">2</span></li></ul></div><div class="widget tags"></div><div class="widget text-content"><p>本博客框架使用<a href="http://hexo.io">Hexo</a>生成,基于<a href="https://github.com/jysperm/hexo-theme-simpleblock">simpleblock</a>主题。</p></div></div></div></div></body></html>